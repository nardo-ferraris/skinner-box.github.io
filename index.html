<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>La Gabbia Invisibile</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Archivo+Black&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f8f7f2;
      --ink: #161616;
      --muted: #585858;
      --card: #ffffff;
      --line: #222;
      --accent: #ff5f3a;
      --accent-2: #07a58d;
      --soft: #f3f3ef;
      --radius: 18px;
      --shadow: 0 14px 40px rgba(0, 0, 0, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: "Space Grotesk", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 88% 8%, #ffe7e0 0 17%, transparent 18%),
        radial-gradient(circle at 10% 84%, #d8fff6 0 16%, transparent 17%),
        var(--bg);
      line-height: 1.6;
    }

    .container { width: min(1120px, 92%); margin-inline: auto; }
    section { padding: 5rem 0; }
    h1, h2, h3 { line-height: 1.1; margin: 0 0 1rem; }
    h1 {
      font-family: "Archivo Black", sans-serif;
      font-size: clamp(2rem, 5vw, 4rem);
      letter-spacing: -0.03em;
    }
    h2 { font-size: clamp(1.5rem, 3vw, 2.5rem); }
    p { margin: 0 0 1rem; color: var(--muted); }

    .hero {
      min-height: 90vh;
      display: grid;
      place-items: center;
      padding: 2rem 0 1rem;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 2rem;
      align-items: center;
    }

    .badge {
      display: inline-block;
      border: 2px solid var(--line);
      border-radius: 999px;
      padding: 0.35rem 0.85rem;
      font-weight: 700;
      background: #fff;
      margin-bottom: 1rem;
    }

    .cta {
      display: inline-block;
      margin-top: 0.6rem;
      text-decoration: none;
      font-weight: 700;
      color: #fff;
      background: var(--ink);
      border: 2px solid var(--ink);
      border-radius: 12px;
      padding: 0.85rem 1.2rem;
      transition: transform 0.2s ease;
    }
    .cta:hover { transform: translateY(-2px); }

    .phone-art {
      width: min(360px, 92%);
      aspect-ratio: 10 / 19;
      margin-inline: auto;
      border: 3px solid var(--line);
      border-radius: 28px;
      background: var(--card);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .phone-screen {
      position: absolute;
      inset: 10px;
      border-radius: 20px;
      background: linear-gradient(165deg, #f2f2f2 0%, #fff 40%, #eef7ff 100%);
      border: 2px solid #dddddd;
    }
    .noti {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      border: 2px solid var(--line);
      border-radius: 999px;
      background: #fff;
      padding: 0.2rem 0.7rem;
      font-weight: 700;
      font-size: 0.9rem;
      animation: floatUp 3.8s infinite ease-in-out;
      z-index: 2;
    }
    .noti:nth-child(2) { bottom: 14%; animation-delay: 0s; }
    .noti:nth-child(3) { bottom: 28%; animation-delay: 0.8s; }
    .noti:nth-child(4) { bottom: 42%; animation-delay: 1.6s; }
    .noti:nth-child(5) { bottom: 56%; animation-delay: 2.4s; }
    .mini-cage {
      position: absolute;
      bottom: 7%;
      left: 8%;
      width: 92px;
      height: 74px;
      border: 3px solid var(--line);
      border-radius: 10px;
      background: repeating-linear-gradient(90deg, #fff 0 9px, #ededed 9px 12px);
      z-index: 2;
    }
    @keyframes floatUp {
      0%, 100% { transform: translate(-50%, 10px); opacity: 0.2; }
      35% { opacity: 1; }
      70% { transform: translate(-50%, -24px); opacity: 0.75; }
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; }
    .card {
      background: var(--card);
      border: 2px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem;
    }
    .mini-title { font-weight: 700; margin-bottom: 0.4rem; }

    .buttons { display: flex; gap: 0.8rem; flex-wrap: wrap; margin: 0.9rem 0; }
    button {
      border: 2px solid var(--line);
      background: #fff;
      color: var(--ink);
      font-weight: 700;
      padding: 0.75rem 1.05rem;
      border-radius: 12px;
      cursor: pointer;
    }
    button.primary { background: var(--accent); }
    button.secondary { background: var(--accent-2); }
    button:disabled { opacity: 0.55; cursor: not-allowed; }

    .sim-box { text-align: center; position: relative; overflow: hidden; }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.8rem;
      text-align: left;
      margin: 0.5rem 0 0.8rem;
    }
    .stat {
      background: var(--soft);
      border-radius: 12px;
      border: 1px solid #e4e4de;
      padding: 0.7rem 0.8rem;
    }
    .stat strong { display: block; color: var(--ink); font-size: 1.2rem; }

    .timer-urgent strong {
      color: #d11717;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
    }
    .urgent-pulse { animation: pulse 0.7s infinite; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.06); }
    }

    .bars-wrap { display: none; margin-top: 1rem; }
    .bars { display: grid; gap: 0.6rem; }
    .bar-row {
      display: grid;
      grid-template-columns: 120px 1fr 56px;
      gap: 0.6rem;
      align-items: center;
    }
    .track {
      height: 14px;
      border-radius: 999px;
      overflow: hidden;
      background: #ecece7;
    }
    .fill {
      height: 100%;
      width: 0%;
      transition: width 0.7s ease;
    }
    .fill.a { background: #b8b8b8; }
    .fill.b { background: var(--accent-2); }
    .compare {
      margin-top: 0.7rem;
      color: #1f1f1f;
      font-weight: 700;
    }
    .schema {
      margin-top: 0.4rem;
      text-align: left;
      background: #f7f7f7;
      border: 1px solid #e5e5e5;
      border-radius: 10px;
      padding: 0.7rem;
      color: #333;
      font-size: 0.95rem;
    }

    .float-reward {
      position: absolute;
      pointer-events: none;
      opacity: 0;
      transform: translate(-50%, 0) scale(0.9);
      animation: rise 0.85s ease forwards;
      z-index: 20;
      font-weight: 700;
      white-space: nowrap;
    }
    .float-reward.a {
      color: #888;
      font-size: 0.86rem;
      opacity: 0.65;
    }
    .float-reward.b {
      color: #0a9b86;
      font-size: 1rem;
    }
    .float-reward.jackpot {
      color: #ff7a00;
      font-size: 1.25rem;
      text-shadow: 0 0 10px rgba(255, 122, 0, 0.4);
    }
    @keyframes rise {
      0%   { transform: translate(-50%, 0) scale(0.9); opacity: 0; }
      18%  { opacity: 1; }
      100% { transform: translate(-50%, -44px) scale(1.05); opacity: 0; }
    }

    .shake { animation: shake 0.28s linear; }
    .shake-jackpot { animation: shakeJackpot 0.45s ease; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-3px); }
      40% { transform: translateX(3px); }
      60% { transform: translateX(-2px); }
      80% { transform: translateX(2px); }
    }
    @keyframes shakeJackpot {
      0%, 100% { transform: translateX(0) scale(1); }
      20% { transform: translateX(-6px) scale(1.03); }
      40% { transform: translateX(6px) scale(1.03); }
      60% { transform: translateX(-4px) scale(1.02); }
      80% { transform: translateX(4px) scale(1.02); }
    }

    .particle {
      position: absolute;
      pointer-events: none;
      font-size: 18px;
      opacity: 0;
      transform: translate(0, 0) scale(0.6);
      animation: burst 700ms ease forwards;
      z-index: 19;
    }
    @keyframes burst {
      0%   { opacity: 1; transform: translate(0, 0) scale(0.6); }
      100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(1.2); }
    }

    .refresh-box {
      border: 2px dashed #c6c6c6;
      border-radius: 12px;
      padding: 0.8rem;
      background: #fafafa;
    }
    .pull-area {
      user-select: none;
      touch-action: none;
      background: #fff;
      border: 2px solid var(--line);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .spinner {
      width: 26px;
      height: 26px;
      border: 3px solid #ddd;
      border-top: 3px solid var(--ink);
      border-radius: 50%;
      margin: 0.5rem auto;
      display: none;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fact {
      margin-top: 0.6rem;
      padding: 0.6rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fff;
    }

    .tips { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .tip {
      display: flex;
      gap: 0.7rem;
      align-items: flex-start;
      background: #f7f7f7;
      border: 1px solid #e8e8e8;
      border-radius: 12px;
      padding: 0.75rem;
    }
    .tip i { font-style: normal; font-size: 1.3rem; line-height: 1; }

    footer {
      padding: 2rem 0 3rem;
      border-top: 2px solid #ddd;
      text-align: center;
      color: var(--muted);
    }
    footer a { color: var(--ink); }

    .fade-in {
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .fade-in.visible { opacity: 1; transform: none; }

    @media (max-width: 900px) {
      section { padding: 4rem 0; }
      .hero-grid, .grid-2, .tips { grid-template-columns: 1fr; }
      .stats { grid-template-columns: 1fr; }
      .bar-row { grid-template-columns: 90px 1fr 48px; }
    }
  </style>
</head>
<body>
  <header class="hero container">
    <div class="hero-grid">
      <div>
        <span class="badge">Psicologia + Tech + Te</span>
        <h1>La Gabbia Invisibile: Perch√© non smetti di controllare il telefono?</h1>
        <p>Scopri il meccanismo psicologico dietro notifiche, like e refresh dei social. Dalla Skinner Box al tuo feed: stessa logica, design diverso.</p>
        <a class="cta" href="#inizia">Inizia il Viaggio</a>
      </div>

      <div class="phone-art" aria-hidden="true">
        <div class="phone-screen"></div>
        <div class="noti">+1 Like</div>
        <div class="noti">Nuova Storia</div>
        <div class="noti">3 Notifiche</div>
        <div class="noti">Messaggio</div>
        <div class="mini-cage"></div>
      </div>
    </div>
  </header>

  <main id="inizia" class="container">
    <section class="fade-in">
      <h2>Il Piccione che Amava Vincere: L'Esperimento di Skinner</h2>
      <div class="grid-2">
        <article class="card">
          <p><strong>Condizionamento operante:</strong> quando un comportamento viene premiato, tendiamo a ripeterlo.</p>
          <p><strong>Ricompensa fissa:</strong> prevedibile, regolare, poco stimolante.</p>
          <p><strong>Ricompensa variabile:</strong> imprevedibile, crea attesa e spinge al re-try continuo.</p>
        </article>
        <article class="card">
          <div class="mini-title">Mini esperimento visivo</div>
          <p>Due pulsanti per il piccione: uno prevedibile, uno a sorpresa.</p>
          <div class="buttons">
            <button id="fixed-demo">Premio Fisso</button>
            <button id="var-demo">Premio Casuale</button>
          </div>
          <p id="bird-log">Il piccione osserva i pulsanti...</p>
        </article>
      </div>
    </section>

    <section class="fade-in">
      <h2>La Skinner Box in Tasca: Come i Social ti ‚ÄúCatturano‚Äù</h2>
      <div class="grid-2">
        <article class="card">
          <p><strong>Parallelismo diretto:</strong> la gabbia √® lo smartphone, ‚Äúbeccare‚Äù √® scrollare o fare refresh, la ricompensa √® la notifica/like/contenuto nuovo.</p>
          <p><strong>Dopamina:</strong> non √® solo piacere, √® anticipazione. Se il premio √® incerto, il cervello resta agganciato.</p>
          <p><strong>Esempi:</strong> pull-to-refresh tipo slot machine, storie che spariscono, puntino rosso.</p>
        </article>
        <article class="card">
          <div class="mini-title">Slot Machine Pull-to-Refresh</div>
          <p>Trascina verso il basso e rilascia per ‚Äúcaricare un nuovo fatto‚Äù. Il ritardo di 1-2 secondi simula l‚Äôattesa intenzionale.</p>
          <div class="refresh-box">
            <div id="pullArea" class="pull-area">
              <strong id="pullLabel">Trascina in basso ‚Üì</strong>
              <div id="spinner" class="spinner"></div>
              <div id="fact" class="fact">Fatto: l'imprevedibilit√† mantiene il comportamento pi√π a lungo.</div>
            </div>
          </div>
          <p style="margin-top:.7rem"><strong>Didattica:</strong> quel micro-ritardo alimenta la domanda: ‚Äúquale premio arriva adesso?‚Äù.</p>
        </article>
      </div>
    </section>

    <section class="fade-in">
      <h2>Prova tu stesso: La Sfida della Ricompensa</h2>
      <article id="simBox" class="card sim-box">
        <p><strong>Regole:</strong> A d√† +1 ogni 5 secondi. B ha 70% zero, 25% premio piccolo (1-3), 5% jackpot (+20).</p>

        <div class="buttons" style="justify-content:center">
          <button class="primary" id="start">Avvia 60 secondi</button>
          <button id="btn-a" disabled>Pulsante A (Fisso)</button>
          <button class="secondary" id="btn-b" disabled>Pulsante B (Variabile)</button>
        </div>

        <div class="stats">
          <div class="stat timer-urgent">Tempo rimasto<strong id="time">60s</strong></div>
          <div class="stat">Click A / Click B<strong id="clicks">0 / 0</strong></div>
          <div class="stat">Punti A / B<strong id="points">0 / 0</strong></div>
        </div>

        <p id="reflection">Premi ‚ÄúAvvia 60 secondi‚Äù e osserva quale pulsante insegui.</p>

        <div id="barsWrap" class="bars-wrap">
          <div class="bars">
            <div class="bar-row">
              <strong>Click A</strong>
              <div class="track"><div id="barA" class="fill a"></div></div>
              <span id="barALabel">0</span>
            </div>
            <div class="bar-row">
              <strong>Click B</strong>
              <div class="track"><div id="barB" class="fill b"></div></div>
              <span id="barBLabel">0</span>
            </div>
          </div>
          <p id="compare" class="compare"></p>
          <div id="schema" class="schema"></div>
        </div>
      </article>
    </section>

    <section class="fade-in">
      <h2>Fuga dalla Gabbia: Riprendi il Controllo</h2>
      <article class="card">
        <p>Capire il meccanismo √® il primo passo. Non serve eliminare la tecnologia: serve usarla in modo consapevole.</p>
        <div class="tips">
          <div class="tip"><i>üîï</i><div><strong>Taglia il rumore</strong><br>Disattiva notifiche non essenziali, soprattutto badge rossi.</div></div>
          <div class="tip"><i>‚è±Ô∏è</i><div><strong>Metti limiti</strong><br>Imposta tempi d‚Äôuso chiari per le app pi√π assorbenti.</div></div>
          <div class="tip"><i>üìµ</i><div><strong>Telefono fuori camera</strong><br>Meno tentazioni, sonno migliore.</div></div>
          <div class="tip"><i>‚ö´‚ö™</i><div><strong>Scala di grigi</strong><br>Meno trigger visivi, meno aperture impulsive.</div></div>
        </div>
      </article>
    </section>
  </main>

  <footer class="container">
    <h3>Questo sito √® stato creato per scopi educativi [Nome della Scuola/Classe].</h3>
    <p>
      Risorse:
      <a href="https://www.thesocialdilemma.com/" target="_blank" rel="noreferrer">The Social Dilemma</a> |
      <a href="https://www.penguinrandomhouse.com/books/533763/irresistible-by-adam-alter/" target="_blank" rel="noreferrer">Irresistible (Adam Alter)</a>
    </p>
  </footer>

  <script>
    // Animazioni reveal
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((e) => e.isIntersecting && e.target.classList.add("visible"));
    }, { threshold: 0.15 });
    document.querySelectorAll(".fade-in").forEach((el) => observer.observe(el));

    // Mini demo Skinner
    const birdLog = document.getElementById("bird-log");
    document.getElementById("fixed-demo").addEventListener("click", () => {
      birdLog.textContent = "Premio fisso: il piccione becca, poi rallenta perch√© √® tutto prevedibile.";
    });
    document.getElementById("var-demo").addEventListener("click", () => {
      const outcomes = [
        "Niente... forse al prossimo.",
        "Piccolo premio!",
        "Ricompensa improvvisa!",
        "Grande premio!"
      ];
      birdLog.textContent = "Premio casuale: " + outcomes[Math.floor(Math.random() * outcomes.length)] + " Il piccione continua a provare.";
    });

    // Pull-to-refresh simulato
    const pullArea = document.getElementById("pullArea");
    const pullLabel = document.getElementById("pullLabel");
    const spinner = document.getElementById("spinner");
    const factBox = document.getElementById("fact");

    const facts = [
      "Fatto: l'incertezza aumenta la frequenza dei tentativi.",
      "Fatto: il ritardo di refresh crea attesa e valore percepito.",
      "Fatto: notifiche e feed usano rinforzi intermittenti.",
      "Fatto: la ricompensa variabile √® pi√π resistente all'estinzione."
    ];

    let startY = null;
    let pulled = 0;
    let loading = false;

    function pointerY(e) {
      return e.touches ? e.touches[0].clientY : e.clientY;
    }

    function pullStart(e) {
      if (loading) return;
      startY = pointerY(e);
      pulled = 0;
    }

    function pullMove(e) {
      if (startY === null || loading) return;
      pulled = Math.max(0, pointerY(e) - startY);
      if (pulled > 70) {
        pullLabel.textContent = "Rilascia per refresh üé∞";
      } else if (pulled > 10) {
        pullLabel.textContent = "Continua a trascinare...";
      }
    }

    function pullEnd() {
      if (startY === null || loading) return;

      if (pulled > 70) {
        loading = true;
        pullLabel.textContent = "Caricamento...";
        spinner.style.display = "block";
        const delay = 1000 + Math.floor(Math.random() * 1000);

        setTimeout(() => {
          spinner.style.display = "none";
          pullLabel.textContent = "Nuovo contenuto!";
          factBox.textContent = facts[Math.floor(Math.random() * facts.length)];
          loading = false;
          setTimeout(() => {
            pullLabel.textContent = "Trascina in basso ‚Üì";
          }, 1200);
        }, delay);
      } else {
        pullLabel.textContent = "Trascina in basso ‚Üì";
      }

      startY = null;
      pulled = 0;
    }

    ["mousedown", "touchstart"].forEach((evt) => pullArea.addEventListener(evt, pullStart, { passive: true }));
    ["mousemove", "touchmove"].forEach((evt) => pullArea.addEventListener(evt, pullMove, { passive: true }));
    ["mouseup", "mouseleave", "touchend", "touchcancel"].forEach((evt) => pullArea.addEventListener(evt, pullEnd, { passive: true }));

    // Sfida della ricompensa
    const GAME_SECONDS = 60;

    const simBox = document.getElementById("simBox");
    const startBtn = document.getElementById("start");
    const btnA = document.getElementById("btn-a");
    const btnB = document.getElementById("btn-b");

    const timeEl = document.getElementById("time");
    const clicksEl = document.getElementById("clicks");
    const pointsEl = document.getElementById("points");
    const reflectionEl = document.getElementById("reflection");

    const barsWrap = document.getElementById("barsWrap");
    const barA = document.getElementById("barA");
    const barB = document.getElementById("barB");
    const barALabel = document.getElementById("barALabel");
    const barBLabel = document.getElementById("barBLabel");
    const compareEl = document.getElementById("compare");
    const schemaEl = document.getElementById("schema");

    let running = false;
    let remaining = GAME_SECONDS;
    let timerId = null;
    let gameStartMs = 0;

    let clicksA = 0;
    let clicksB = 0;
    let pointsA = 0;
    let pointsB = 0;

    // A: esattamente 1 punto ogni blocco da 5 secondi
    let lastGrantedBucket = 0;

    function updateChallengeUI() {
      timeEl.textContent = remaining + "s";
      clicksEl.textContent = clicksA + " / " + clicksB;
      pointsEl.textContent = pointsA + " / " + pointsB;

      if (remaining <= 10) {
        timeEl.classList.add("urgent-pulse");
      } else {
        timeEl.classList.remove("urgent-pulse");
      }
    }

    function floatReward(text, button, tone) {
      const simRect = simBox.getBoundingClientRect();
      const bRect = button.getBoundingClientRect();
      const el = document.createElement("span");
      el.className = "float-reward " + tone;
      el.textContent = text;
      el.style.left = (bRect.left - simRect.left + bRect.width / 2) + "px";
      el.style.top = (bRect.top - simRect.top + 6) + "px";
      simBox.appendChild(el);
      setTimeout(() => el.remove(), 900);
    }

    function shakeButton(button, jackpot) {
      button.classList.remove("shake", "shake-jackpot");
      void button.offsetWidth;
      button.classList.add(jackpot ? "shake-jackpot" : "shake");
    }

    function jackpotBurst(button) {
      const icons = ["‚≠ê", "‚ú®", "üéâ"];
      const simRect = simBox.getBoundingClientRect();
      const bRect = button.getBoundingClientRect();
      const ox = bRect.left - simRect.left + bRect.width / 2;
      const oy = bRect.top - simRect.top + bRect.height / 2;

      for (let i = 0; i < 14; i++) {
        const p = document.createElement("span");
        p.className = "particle";
        p.textContent = icons[Math.floor(Math.random() * icons.length)];
        p.style.left = ox + "px";
        p.style.top = oy + "px";
        p.style.setProperty("--dx", (Math.random() * 180 - 90) + "px");
        p.style.setProperty("--dy", (-40 - Math.random() * 140) + "px");
        simBox.appendChild(p);
        setTimeout(() => p.remove(), 700);
      }
    }

    function renderBarsAndDebrief() {
      const maxClicks = Math.max(clicksA, clicksB, 1);
      const widthA = Math.round((clicksA / maxClicks) * 100);
      const widthB = Math.round((clicksB / maxClicks) * 100);

      barA.style.width = widthA + "%";
      barB.style.width = widthB + "%";
      barALabel.textContent = String(clicksA);
      barBLabel.textContent = String(clicksB);

      const ratio = clicksA === 0 ? (clicksB > 0 ? Infinity : 1) : clicksB / clicksA;
      const ratioText = ratio === Infinity ? "‚àû" : ratio.toFixed(2);
      compareEl.textContent = "Rapporto click B/A: " + ratioText + " (A: " + clicksA + ", B: " + clicksB + ")";

      if (clicksB > clicksA * 1.5) {
        reflectionEl.textContent = "Il tuo cervello √® stato catturato dal Jackpot. Hai ignorato la certezza del Pulsante A per inseguire la scarica di dopamina di B.";
      } else {
        reflectionEl.textContent = "Pattern pi√π equilibrato: hai resistito meglio alla spinta del rinforzo variabile.";
      }

      schemaEl.innerHTML =
        "<strong>Come funziona il gioco:</strong><br>" +
        "1) <strong>Pulsante A</strong>: +1 punto solo quando passa un nuovo blocco da 5 secondi.<br>" +
        "2) <strong>Pulsante B</strong>: 70% = 0, 25% = 1-3 punti, 5% = jackpot 20 punti.<br>" +
        "3) Il jackpot usa shake + testo fluttuante + esplosione visiva per imitare un hit dopaminergico.<br>" +
        "4) Confrontiamo i click finali per misurare l'attrazione verso l'incertezza.";

      barsWrap.style.display = "block";
    }

    function startChallenge() {
      clearInterval(timerId);

      running = true;
      remaining = GAME_SECONDS;
      gameStartMs = Date.now();

      clicksA = 0;
      clicksB = 0;
      pointsA = 0;
      pointsB = 0;
      lastGrantedBucket = 0;

      startBtn.disabled = true;
      btnA.disabled = false;
      btnB.disabled = false;

      barsWrap.style.display = "none";
      reflectionEl.textContent = "Test in corso: osserva la pressione del timer e i tuoi impulsi.";
      updateChallengeUI();

      timerId = setInterval(() => {
        remaining -= 1;
        updateChallengeUI();

        if (remaining <= 0) {
          clearInterval(timerId);
          running = false;
          btnA.disabled = true;
          btnB.disabled = true;
          startBtn.disabled = false;
          renderBarsAndDebrief();
        }
      }, 1000);
    }

    startBtn.addEventListener("click", startChallenge);

    // Pulsante A: rinforzo fisso
    btnA.addEventListener("click", () => {
      if (!running) return;
      clicksA += 1;

      const elapsedMs = Date.now() - gameStartMs;
      const currentBucket = Math.floor(elapsedMs / 5000);

      if (currentBucket >= 1 && currentBucket > lastGrantedBucket) {
        pointsA += 1;
        lastGrantedBucket = currentBucket;
        floatReward("+1", btnA, "a");
      } else {
        // feedback minimo, grigio
        floatReward("0", btnA, "a");
      }

      updateChallengeUI();
    });

    // Pulsante B: rinforzo variabile 70/25/5
    btnB.addEventListener("click", () => {
      if (!running) return;
      clicksB += 1;

      const roll = Math.random();
      let reward = 0;
      let jackpot = false;

      if (roll < 0.70) {
        reward = 0;
      } else if (roll < 0.95) {
        reward = 1 + Math.floor(Math.random() * 3); // 1-3
      } else {
        reward = 20; // jackpot 5%
        jackpot = true;
      }

      if (reward > 0) {
        pointsB += reward;
        shakeButton(btnB, jackpot);
        floatReward("+" + reward + "‚≠ê", btnB, jackpot ? "jackpot" : "b");
        if (jackpot) jackpotBurst(btnB);
      } else {
        floatReward("0", btnB, "b");
      }

      updateChallengeUI();
    });
  </script>
</body>
</html>
